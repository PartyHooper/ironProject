<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href='/stylesheets/bootstrap.min.css' rel="stylesheet">
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <link rel='stylesheet' href='/stylesheets/bootstrap-social.css' />
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <title>Hopper</title>
</head>
<body>
    <div class="topBar">
        <a href="/"><h2 class="title">Skryer</h2></a>
        <% if(!logged){%>
            <a href="/auth/facebook"><button class="btn-social-icon btn-facebook"><span class="fab fa-facebook-square"></span></button></a>
            <a href="/auth/instagram" ><button class="btn-social-icon btn-instagram"><span class="fab fa-instagram"></span></button></a>
        <%} else {%>
            <img class="profilePic" src=<%=user.picPath%>>
            <span>Welcome <%=user.provider_name%></span>
            <a href="/logout"><p class="logout">Logout</p></a>
        <% } %>
    </div>
    
<!-- Search and filter -->
    <form id="myForm" action="/search" method="post">
        <div class="topnav">
                <input list="places" name="place">
            <datalist id="places" >
                <%places.forEach(function(place){%>
                     <option value="<%=place.name%>">
                <%})%>
              </datalist>
            <input type ="submit" id="searchInput" value="Buscar">
            <!-- <input  type="button" id="searchInput" value="Buscar"/> -->
            <button id="filter" type="menu">
               <p> Filtrar</p>
               <img width="20px" src="images/filtro.png" alt="filtro">
            </button>	
        </div>  
    </form>
    <a href=<%='/'+places[0]._id+"/review"%>><p>It looks like you are at <%=places[0].name%></p><p>Tell us how it is!</p></a>
    <div id="currentContainer">
        <% places.forEach(function(place){%>
            <a href=<%="/"+place._id%>><div class="place-container">
                    <figure class="crop-image">
                        <img src="<%=place.picPath%>">
                    </figure>
                    <div class="rating-container">
                    <p class="place-name"><%=place.name%></p></div></div></a>
                    <% let avgRating = 0 %>
            <% let musicCount = [] %>
            <% let crowdCount = 0 %>
             <% place.reviews.forEach(function(review){ %>
               <% avgRating+=review.rating/place.reviews.length; %>
                <% crowdCount+=review.crowded/place.reviews.length; %>
                <% let exists=false; %>
                <% musicCount.map(function(music){ %>
                  <%  if (music.genre===review.music){ %>
                   <%     music.count++; %>
                    <%    exists=true; %>
                   <%  } %>
               <% })%>
                <%if (!exists){%>
              <%      musicCount.push({genre: review.music, count: 1})%>
               <% }%>
          <%  })%>
          <% if (place.reviews.length>0){ %>
           <p>Night Rating: <%=avgRating%></p>`
            <% for(var s=0; s<avgRating; s++){%>
               <% if (avgRating-1<s){ %>
             <span class="fas fa-star-half"></span>
                 } else {
                   <span class="fas fa-star"></span>
                }
             }
            } else {
              <p>No updates yet</p>
            }
        <%})%>
        </div>
  <img id="loading" src="/images/loading.png" alt="">  
</body>
<script>
    var placesArray=<%- JSON.stringify(places) %>
    console.log(placesArray);
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBkS2ZKYa3xtCIJpDDZxsGbbzjG2Yobrww&libraries=places">
    </script>
<!-- 
<script type="text/javascript" src="/javascripts/main.js"></script> -->
</html>

